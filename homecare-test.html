<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Upload or Camera Capture Demo</title>
    <style>
        /* General page styling and centering */
        body {
            font-family: Arial, sans-serif;
            background: #f5f5f5;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .container {
            background: #fff;
            margin-top: 2rem;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 400px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .button-group {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        .thumbnail {
            margin-top: 1rem;
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 8px;
            border: 1px solid #ccc;
            display: none;
        }
        .output-box {
            margin-top: 2rem;
            width: 100%;
        }
        textarea {
            width: 100%;
            height: 80px;
            resize: none;
            border-radius: 6px;
            border: 1px solid #ccc;
            padding: 0.5rem;
            font-size: 1rem;
            background: #f0f0f0;
        }
        @media (max-width: 600px) {
            .container {
                padding: 1rem;
                margin-top: 1rem;
            }
            .button-group {
                flex-direction: column;
                gap: 0.5rem;
                width: 100%;
            }
            .output-box {
                margin-top: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Button group for image upload or camera capture -->
        <div class="button-group">
            <!-- Desktop: Image Upload Button -->
            <label id="uploadLabel" style="display:none;">
                <input type="file" id="uploadInput" accept="image/*" style="display:none;">
                <button type="button">Upload Image</button>
            </label>
            <!-- Mobile: Camera Capture Button -->
            <label id="cameraLabel" style="display:none;">
                <input type="file" id="cameraInput" accept="image/*" capture="environment" style="display:none;">
                <button type="button">Open Camera</button>
            </label>
        </div>
        <!-- Thumbnail preview for selected/captured image -->
        <img id="thumbnail" class="thumbnail" alt="Image preview">

        <!-- Read-only output text box -->
        <div class="output-box">
            <label for="outputText">Output:</label>
            <textarea id="outputText" readonly placeholder="Output will appear here..."></textarea>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
    <script>
        // Purpose: Detect device type and show the appropriate button
        function isMobileDevice() {
            return /Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
        }

        // Show the correct button based on device
        window.onload = function() {
            if (isMobileDevice()) {
                document.getElementById('cameraLabel').style.display = 'inline-block';
            } else {
                document.getElementById('uploadLabel').style.display = 'inline-block';
            }
        };

        // Purpose: Handle image upload (desktop)
        document.getElementById('uploadInput').addEventListener('change', function(event) {
            showThumbnail(event.target.files[0]);
        });

        // Purpose: Handle camera capture (mobile)
        document.getElementById('cameraInput').addEventListener('change', function(event) {
            showThumbnail(event.target.files[0]);
        });

        // Purpose: Show thumbnail of selected/captured image and run OCR
        function showThumbnail(file) {
            if (!file) return;
            const img = document.getElementById('thumbnail');
            img.src = URL.createObjectURL(file);
            img.style.display = 'block';

            // Run OCR using Tesseract.js
            const output = document.getElementById('outputText');
            output.value = "Recognizing text...";
            Tesseract.recognize(
                file,
                'eng'
            ).then(({ data: { text } }) => {
                output.value = text;
            }).catch(err => {
                output.value = "OCR failed: " + err;
            });
        }

        // Purpose: Button click triggers file input
        document.querySelector('#uploadLabel button').onclick = function() {
            // Reset the input value to ensure change event always fires
            const uploadInput = document.getElementById('uploadInput');
            uploadInput.value = '';
            uploadInput.click();
        };
        document.querySelector('#cameraLabel button').onclick = function() {
            const cameraInput = document.getElementById('cameraInput');
            cameraInput.value = '';
            cameraInput.click();
        };
    </script>
    <script>
    // Purpose: Detect device type and show the appropriate button
    function isMobileDevice() {
        return /Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
    }

    // Show the correct button based on device
    window.onload = function() {
        if (isMobileDevice()) {
            document.getElementById('cameraLabel').style.display = 'inline-block';
        } else {
            document.getElementById('uploadLabel').style.display = 'inline-block';
        }
    };

    // Purpose: Handle image upload (desktop)
    document.getElementById('uploadInput').addEventListener('change', function(event) {
        showThumbnail(event.target.files[0]);
    });

    // Purpose: Handle camera capture (mobile)
    document.getElementById('cameraInput').addEventListener('change', function(event) {
        showThumbnail(event.target.files[0]);
    });

    // Purpose: Show thumbnail of selected/captured image
    function showThumbnail(file) {
        if (!file) return;
        const img = document.getElementById('thumbnail');
        img.src = URL.createObjectURL(file);
        img.style.display = 'block';
    }

    // Purpose: Button click triggers file input
    document.querySelector('#uploadLabel button').onclick = function() {
        // Reset the input value to ensure change event always fires
        const uploadInput = document.getElementById('uploadInput');
        uploadInput.value = '';
        uploadInput.click();
    };
    document.querySelector('#cameraLabel button').onclick = function() {
        const cameraInput = document.getElementById('cameraInput');
        cameraInput.value = '';
        cameraInput.click();
    };
</script>
</body>
</html>
